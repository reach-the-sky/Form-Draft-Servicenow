<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_ui_action">
    <sys_ui_action action="INSERT_OR_UPDATE">
        <action_name>sysverb_cancel</action_name>
        <active>true</active>
        <client>true</client>
        <client_script_v2><![CDATA[function onClick(g_form) {

}]]></client_script_v2>
        <comments/>
        <condition>current.canWrite()</condition>
        <form_action>true</form_action>
        <form_button>true</form_button>
        <form_button_v2>false</form_button_v2>
        <form_context_menu>false</form_context_menu>
        <form_link>false</form_link>
        <form_menu_button_v2>false</form_menu_button_v2>
        <form_style/>
        <format_for_configurable_workspace>false</format_for_configurable_workspace>
        <hint>Create a new draft for future use</hint>
        <isolate_script>true</isolate_script>
        <list_action>false</list_action>
        <list_banner_button>false</list_banner_button>
        <list_button>false</list_button>
        <list_choice>false</list_choice>
        <list_context_menu>false</list_context_menu>
        <list_link>false</list_link>
        <list_save_with_form_button>false</list_save_with_form_button>
        <list_style/>
        <messages/>
        <name>Create Draft</name>
        <onclick>createDraft()</onclick>
        <order>-1100</order>
        <script><![CDATA[function createDraft() {
	
  // Get the current form record
  var tableName = g_form.getTableName();

  // Get the form fields and values
  var fields = g_form.getEditableFields();

  var fields_keys = [];
  var field_values = [];
  var field_data = {};

  for(var i = 0; i < fields.length; i++) {
	var value = g_form.getValue(fields[i]);
	if(value != null && value != "") {
		fields_keys.push(fields[i]);
		field_values.push(value);
		field_data[fields[i]] = value;
	}
  }

  if(navigator.onLine) {
	var gm = new GlideModal("glide_prompt", true, 600);
	gm.setTitle("Form Draft");
	gm.setPreference("title", "Enter a name for draft: ");
	gm.setPreference("onPromptComplete", complete);
	gm.render();
  }
  else {
	var draft_name = prompt("Enter draft name (offline]]>ðŸ“µ<![CDATA[):");
	complete(draft_name);
  }

  function complete(value) {

	if(!isValidName(value)) {
		g_form.addErrorMessage("Add valid name, don't add special characters");
		return;
	}

	if(navigator.onLine){
		// Call the server-side script through AJAX
		var ga = new GlideAjax('FormDraftAjax');
		ga.addParam('sysparm_name', 'createDraft');
		ga.addParam('sysparm_tablename', tableName);
		ga.addParam('sysparm_fields', fields_keys.join(','));
		ga.addParam("sysparam_field_values", JSON.stringify(field_values));
		ga.addParam("sysparam_record_name", value);
		ga.getXMLAnswer(function(response) {
			if (response == 'success') {
				g_form.addInfoMessage("Saved draft: " + value);
			} else if(response == "duplicate") {
				g_form.addErrorMessage("Duplicate draft name given");
			} else {
				g_form.addInfoMessage("No internet, saved draft locally.");
			}
		});
	}
	else {
		FormDraftClient.setLocalData(tableName, value, JSON.stringify(field_data));
		g_form.addInfoMessage("No internet]]>ðŸ“µ<![CDATA[, saved draft locally.");
	}
  }
  
  function isValidName(value) {
	
	if(value == null || value == "")
		return false;
	var regex = /^[a-zA-Z0-9\s]+$/;
	return regex.test(value);
  }
}]]></script>
        <show_insert>true</show_insert>
        <show_multiple_update>false</show_multiple_update>
        <show_query>false</show_query>
        <show_update>true</show_update>
        <sys_class_name>sys_ui_action</sys_class_name>
        <sys_created_by>kotnikrish.chaitanya@snc</sys_created_by>
        <sys_created_on>2023-06-24 13:35:59</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>940f2af683a721102f5a4ef16daad3a7</sys_id>
        <sys_mod_count>26</sys_mod_count>
        <sys_name>Create Draft</sys_name>
        <sys_overrides/>
        <sys_package display_value="Form Draft" source="bdfd2ab683a721102f5a4ef16daad31b">bdfd2ab683a721102f5a4ef16daad31b</sys_package>
        <sys_policy/>
        <sys_scope display_value="Form Draft">bdfd2ab683a721102f5a4ef16daad31b</sys_scope>
        <sys_update_name>sys_ui_action_940f2af683a721102f5a4ef16daad3a7</sys_update_name>
        <sys_updated_by>kotnikrish.chaitanya@snc</sys_updated_by>
        <sys_updated_on>2023-06-29 11:24:51</sys_updated_on>
        <table>global</table>
        <ui11_compatible>false</ui11_compatible>
        <ui16_compatible>false</ui16_compatible>
    </sys_ui_action>
</record_update>
